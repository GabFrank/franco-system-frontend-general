<div
  fxLayout="column"
  style="width: 100%; height: 90%"
  fxLayoutAlign="start center"
>
  <div
    fxFlex
    fxLayout="row"
    fxLayoutGap="20px"
    style="width: 90%; height: 100%"
  >
    <mat-card
      fxFlex="20%"
      style="background-color: rgb(32, 32, 32); height: 100%"
      fxLayout="column"
    >
      <div
        fxFlex="90%"
        fxLayout="column"
        fxLayoutAlign="start start"
        fxLayoutGap="10px"
      >
        <div style="width: 100%" fxFlexAlign="start">
          <button
            [color]="stepper.selectedIndex == 0 ? 'accent' : ''"
            mat-raised-button
            style="width: 100%"
          >
            Detalle
          </button>
        </div>
        <div style="width: 100%" fxFlexAlign="start">
          <button
            [color]="stepper.selectedIndex == 1 ? 'accent' : ''"
            mat-raised-button
            style="width: 100%"
          >
            Producto
          </button>
        </div>
        <div style="width: 100%" fxFlexAlign="start">
          <button
            [color]="stepper.selectedIndex == 2 ? 'accent' : ''"
            mat-raised-button
            style="width: 100%"
          >
            Financiero
          </button>
        </div>
      </div>
      <div fxFlex="10%" fxLayoutAlign="end" style="width: 100%">
        <div fxFlex fxFlexAlign="end">
          <button color="primary" mat-raised-button style="width: 100%">
            Salir
          </button>
        </div>
      </div>
    </mat-card>
    <mat-card
      fxFlex="80%"
      style="background-color: rgb(32, 32, 32); height: 100%"
    >
      <mat-stepper
        fxLayout="column"
        linear
        #stepper
        style="width: 100%; height: 100%"
      >
        <mat-step style="width: 100%; height: 100% !important;">
          <ng-template matStepLabel>Detalle</ng-template>
          <form fxLayout="column" [formGroup]="detalleForm" style="width: 100%; height: 100%;">
            <div
              fxFlex
              fxLayout="row"
              style="width: 100%"
              fxLayoutAlign="space-between start"
            >
              <div fxFlex="20" fxFlexAlign="start">
                ID: {{ selectedPedido?.id }}
              </div>
              <div fxFlex="50" fxFlexAlign="start">
                Responsable:
                {{ selectedPedido?.usuario?.persona?.nombre | uppercase }}
              </div>
              <div fxFlex="20" fxFlexAlign="start">
                Fecha: {{ selectedPedido?.creadoEn }}
              </div>
            </div>
            <div
              fxFlex
              fxLayout="row"
              style="width: 100%"
              fxLayoutAlign="space-between start"
            >
              <div fxFlex="50">
                <mat-form-field style="width: 90%">
                  <mat-label>Proveedor</mat-label>
                  <input
                    #proveedorInput
                    type="text"
                    matInput
                    [formControl]="proveedorControl"
                    oninput="this.value == ' ' ? this.value = '': null"
                    [matAutocomplete]="autoProveedor"
                  />
                  <mat-autocomplete
                    #autoProveedor="matAutocomplete"
                    (optionSelected)="onProveedorSelect($event.option.value)"
                    (closed)="onProveedorAutocompleteClose()"
                  >
                    <mat-option
                      *ngFor="let proveedor of proveedorList"
                      [value]="proveedor"
                    >
                      {{ proveedor.id }} -
                      {{ proveedor?.persona?.nombre | uppercase }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </div>
              <div fxFlex="50" fxFlexAlign="end">
                <mat-form-field style="width: 90%">
                  <mat-label>Vendedor</mat-label>
                  <input
                    #vendedorInput
                    type="text"
                    matInput
                    [formControl]="vendedorControl"
                    oninput="this.value == ' ' ? this.value = '': null"
                    [matAutocomplete]="autoVendedor"
                  />
                  <mat-autocomplete
                    #autoVendedor="matAutocomplete"
                    (optionSelected)="onVendedorSelect($event.option.value)"
                    (closed)="onVendedorAutocompleteClose()"
                  >
                    <mat-option
                      *ngFor="let vendedor of vendedorList"
                      [value]="vendedor"
                    >
                      {{ vendedor.id }} -
                      {{ vendedor?.persona?.nombre | uppercase }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </div>
            </div>
            <div fxFlex fxLayout="row" fxLayoutAlign="space-between start">
              <div fxFlex>
                <mat-form-field>
                  <mat-label>Forma de Pago</mat-label>
                  <mat-select [formControl]="formaPagoControl" name="formaPago">
                    <mat-option
                      *ngFor="let formaPago of formaPagoList"
                      [value]="selectedFormaPago"
                    >
                      {{ formaPago.id }} -
                      {{ formaPago.descripcion | uppercase }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div fxFlex>
                <mat-form-field>
                  <mat-label>Moneda</mat-label>
                  <mat-select [formControl]="monedaControl" name="moneda">
                    <mat-option
                      *ngFor="let moneda of monedaList"
                      [value]="selectedMoneda"
                    >
                      {{ moneda.id }} - {{ moneda.denominacion | uppercase }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div fxFlex="10" fxFlexAlign="center">
                <mat-checkbox [formControl]="creditoControl"
                  >Crédito</mat-checkbox
                >
              </div>
              <div fxFlex *ngIf="creditoControl.value">
                <mat-form-field style="width: 90%">
                  <mat-label>Plazo en días</mat-label>
                  <input
                    matInput
                    type="number"
                    [formControl]="plazoCreditoControl"
                    min="1"
                  />
                </mat-form-field>
              </div>
              <div fxFlex fxFlexAlign="start">
                <mat-form-field>
                  <mat-label>Fecha de entrega</mat-label>
                  <input
                    matInput
                    [matDatepicker]="picker"
                    [formControl]="fechaEntregaControl"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="picker"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
              </div>
            </div>
            <mat-card
              fxLayout="column"
              fxLayoutGap="10px"
              fxFlex="90"
              fxFlexFill
              style="background-color: rgb(32, 32, 32); height: 100%"
            >
              <div fxFlex="5" fxLayout="row" fxLayoutAlign="end center">
                <div fxFlex="5" fxFlexAlign="center">
                  <mat-icon color="primary">delete</mat-icon>
                </div>
                <div fxFlex="10">
                  <button color="primary" mat-raised-button (click)="onAdicionar()">Adicionar +</button>
                </div>
              </div>
              <div fxFlex="95">
                <table
                  style="width: 100%; height: 100%;"
                  mat-table
                  [dataSource]="dataSource"
                  multiTemplateDataRows
                  >
                  <ng-container
                    matColumnDef="numero"
                  >
                    <th mat-header-cell *matHeaderCellDef style="width: 5%;">#</th>
                    <td mat-cell *matCellDef="let pedidoItem; let i = index" style="width: 5%;">
                      {{ i }}
                    </td>
                  </ng-container>

                  <ng-container
                    matColumnDef="producto"
                  >
                    <th mat-header-cell *matHeaderCellDef style="width: 40%;">Producto</th>
                    <td mat-cell *matCellDef="let pedidoItem; let i = index" style="width: 30%;">
                      {{ pedidoItem?.producto?.descripcion | uppercase }}
                    </td>
                  </ng-container>

                  <ng-container
                    matColumnDef="presentacion"
                  >
                    <th mat-header-cell *matHeaderCellDef style="width: 10%;">Presentación</th>
                    <td mat-cell *matCellDef="let pedidoItem; let i = index" style="width: 10%;">
                      {{ pedidoItem?.presentacion?.descripcion | uppercase }}
                    </td>
                  </ng-container>

                  <ng-container
                    matColumnDef="cantidad"
                  >
                    <th mat-header-cell *matHeaderCellDef style="width: 10%;">Cantidad</th>
                    <td mat-cell *matCellDef="let pedidoItem; let i = index" style="width: 10%;">
                      {{ pedidoItem?.cantidad }}
                    </td>
                  </ng-container>

                  <ng-container
                    matColumnDef="precioUnitario"
                  >
                    <th mat-header-cell *matHeaderCellDef style="width: 10%;">P. Unitario</th>
                    <td mat-cell *matCellDef="let pedidoItem; let i = index" style="width: 10%;">
                      {{ pedidoItem?.precioUnitario }}
                    </td>
                  </ng-container>

                  <ng-container
                    matColumnDef="descuentoUnitario"
                  >
                    <th mat-header-cell *matHeaderCellDef style="width: 10%;">Descuento</th>
                    <td mat-cell *matCellDef="let pedidoItem; let i = index" style="width: 10%;">
                      {{ pedidoItem?.descuento }}
                    </td>
                  </ng-container>

                  <ng-container
                    matColumnDef="bonificacion"
                  >
                    <th mat-header-cell *matHeaderCellDef style="width: 10%;">Bofinicación</th>
                    <td mat-cell *matCellDef="let pedidoItem; let i = index" style="width: 10%;">
                      {{ pedidoItem?.bonificacion == true ? 'Si' : 'No' }}
                    </td>
                  </ng-container>

                  <ng-container
                    matColumnDef="acciones"
                  >
                    <th mat-header-cell *matHeaderCellDef style="width: 10%;"></th>
                    <td mat-cell *matCellDef="let pedidoItem; let i = index" style="width: 10%;">
                      ...
                    </td>
                  </ng-container>

                  <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                  <ng-container matColumnDef="expandedDetail">
                    <td
                      mat-cell
                      *matCellDef="let pedidoItem"
                      [attr.colspan]="columnsToDisplay.length"
                    >
                      <div
                        class="example-pedidoItem-detail"
                        [@detailExpand]="
                          pedidoItem == expandedPedidoItem ? 'expanded' : 'collapsed'
                        "
                      ></div>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
                  <tr
                    mat-row
                    *matRowDef="let pedidoItem; columns: columnsToDisplay"
                    class="example-pedidoItem-row"
                    [class.example-expanded-row]="expandedPedidoItem === pedidoItem"
                    (click)="
                      expandedPedidoItem =
                        expandedPedidoItem === pedidoItem ? null : pedidoItem
                    "
                  ></tr>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: ['expandedDetail']"
                    class="example-detail-row"
                  ></tr>
                </table>
              </div>
            </mat-card>
          </form>
        </mat-step>
        <mat-step style="width: 100%">
          <ng-template matStepLabel>Producto</ng-template>
        </mat-step>
        <mat-step style="width: 100%">
          <ng-template matStepLabel>Financiero</ng-template>
        </mat-step>
      </mat-stepper>
    </mat-card>
  </div>
</div>
